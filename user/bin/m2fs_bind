#!/bin/bash
#  In section 9.2.2 we will install LFS-Bootscripts, among those scripts
#  is a program mountvirtfs, which does pretty much what this script does.
#  Maybe we should copy that into our bin directory and invoke that.

if [[ "$LFS_ENV" != "m1_root" ]];then
  echo $(basename "$0") "must be run in env_m1_root"
  exit 1
fi

mkdir -p "$LFS_M2_FS/dev" 
mount -v --bind /dev "$LFS_M2_FS/dev"

mkdir -p "$LFS_M2_FS/dev/pts"
mount -v --bind /dev/pts "$LFS_M2_FS/dev/pts"

mkdir -p "$LFS_M2_FS/proc"
mount -vt proc proc "$LFS_M2_FS/proc"

mkdir -p "$LFS_M2_FS/sys"
mount -vt sysfs sysfs "$LFS_M2_FS/sys"

mkdir -p "$LFS_M2_FS/run"
mount -vt tmpfs tmpfs "$LFS_M2_FS/run"

# bind our sources directory
repo_dir_target="$LFS_M2_FS$LFSM2_REPO_DIR"
mkdir -p "$repo_dir_target"
mount -v --bind "$REPO_DIR" "$repo_dir_target"

if [[ "$LFS_BOOT_STYLE" == "UEFI" ]]; then
  mkdir -pv "$LFS_M2_FS/sys/firmware/efi/efivars" && mount -v -t efivarfs efivarfs "$LFS_M2_FS/sys/firmware/efi/efivars"
fi

