#!/bin/bash
# just goes backwards from m2_fs_bind

if [[ "$LFS_ENV" != "m1_root" ]];then
 echo $(basename "$0") "must be run from env_m1_root"
 exit 1
fi

# set -x

# found that the absolute pathname is necessary, independent of the current pwd


echo "Careful! Any umount failure followed by an rm -r on m2fs will delete things from the mounted device or directory! This is the most common way to kill the build system or ruin the boot partition." 
umount -v "$LFS_M2_FS$LFSM2_REPO_DIR"
umount -v "$LFS_M2_FS_MP/run"
umount -v "$LFS_M2_FS_MP/proc"
umount -v "$LFS_M2_FS_MP/dev/pts"
umount -v "$LFS_M2_FS_MP/dev" 

mountpoint -q "$LFS_M2_FS_MP/sys/firmware/efi/efivars" && umount -v "$LFS_M2_FS_MP/sys/firmware/efi/efivars"
umount -v "$LFS_M2_FS_MP/sys"
