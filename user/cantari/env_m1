#!/bin/bash
#
# most of this comes from section 4.4
#
# bash without -i resets PS1
#
# REPO_HOME - location of a number of repos including this one - set in .bashrc
# REPO      - name of this repo, probably - given as argument to my 'repo' command when entering the repo (see resource repo)
# these are then derived:
# REPO_DIR  - set in the repo command script to $REPO_HOME/$REPO as a convenience
# REPO_USER_DIR - set by the REPO_DIR/activate to $REPO_USER_DIR, users should use this so they stay in the user dir
# PROJECT   - only used in the [] of the PS1 prompt, the 'repo' command sets it to $REPO, but may be set to anything
#
# set -x

script="$@"

if [[ ! -f "$REPO_USER_DIR/build/configuration" ]]; then
  echo "build/configuration is missing.  See library/configuration for an example. Exiting."
  exit 1
fi

if [[ -z "$script" ]]; then
  script=/bin/bash\ --init-file\ "$REPO_USER_DIR"/library/bashrc_lfs
fi

source frame-initialize

env --ignore-environment \
  HOME="$HOME"\
  HOSTNAME="$HOSTNAME"\
  TMP="$TMP"\
  TZ="$TZ"\
  TIME_STYLE="$TIME_STYLE"\
  LANG="$LANG"\
  TERM="$TERM" \
  TERMCAP="$TERMCAP" \
  EDITOR="$EDITOR" \
  PPS1="$PPS1"\
  PPS2="$PPS2"\
  REPO_HOME="$REPO_HOME"\
  REPO="$REPO"\
  REPO_DIR="$REPO_DIR"\
  PROJECT="$PROJECT:env_m1"\
  LFS_ENV="m1"\
  LFS_LOG="$LFS_LOG"\
  "$REPO_USER_DIR"/cantari/env_m1-1 $script
  

# set +x
