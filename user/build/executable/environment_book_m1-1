#!/bin/bash
# bash without -i resets PS1
# except for the log file variables this comes from section 4.4

pps1="$1"
pps2="$2"
repo_home="$3"
project_home="$4"
project="$5"
lfs_build_dir="$6"
lfs_m2_filesystem="$7"
frame_log="$8"
build_log="$9"
script="${@:10}"

# according to the book	   
umask 022
LFS_M2_FILESYSTEM="$lfs_m2_filesystem"
LC_ALL=POSIX
LFS_TGT="$(uname -m)-lfs-linux-gnu"
PATH="/usr/bin"
if [ ! -L /bin ]; then 
  export PATH="/bin:$PATH"
fi	 
PATH=$LFS_M2_FILESYSTEM/tools/bin:$PATH
CONFIG_SITE="$lfs_m2_filesystem/usr/share/config.site"
MAKEFLAGS="-j12" 
export LFS_M2_FILESYSTEM LC_ALL LFS_TGT PATH CONFIG_SITE MAKEFLAGS 

# our local systems programs, eg. Z
PATH="/usr/local/bin:$PATH"
export PATH

# repo environment
REPO_HOME="$repo_home"
PROJECT="$project:book-m1"
export REPO_HOME PROJECT_HOME PROJECT

# for our build scripts
LFS_BUILD_DIR="$lfs_build_dir"
PATH="$LFS_BUILD_DIR/executable:$PATH"
LFS_LOG_DIR="$LFS_BUILD_DIR/log"
LFS_FRAME_LOG="$frame_log"
LFS_BUILD_LOG="$build_log"

export LFS_BUILD_DIR LFS_LOG_DIR LFS_ARCHIVE_DIR PATH LFS_FRAME_LOG	LFS_BUILD_LOG 

# without -i bash clears PS1, just because
PPS1="$pps1"
PPS2="$pps2"
PS1="$pps1"
PS2="$pps2"
TZ=UTC
TIME_STYLE=long-iso
export PPS1 PPS2 PS1 PS2 TZ TIME_STYLE

$script
