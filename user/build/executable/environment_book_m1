#!/bin/bash
# bash without -i resets PS1
# except for the log file variables this comes from section 4.4
# set -x

if [[ -z "$LFS_M2_FILESYSTEM" ]]; then
  export LFS_M2_FILESYSTEM="/mnt/m2_filesystem"
fi

script="$@"
if [[ -z "$script" ]]; then
  script="/bin/bash --norc"
fi

# we will use our local version of Z so that it will be found after the chroot
# copied from .bashrc /usr/bin/Z -> Z
# might be better to include Z in the m1 build so it is still /usr/local/bin/Z on m2
PPS1='\n$(Z)[$PROJECT]\n\u@\hยง$(pwd)ยง\n> '
PS1="$PPS1"

env -i "$LFS_BUILD_DIR/executable/environment_book_m1-1"\
  "$PPS1"\
  "$PPS2"\
  "$REPO_HOME"\
  "$PROJECT_HOME"\
  "$PROJECT"\
  "$LFS_BUILD_DIR"\
  "$LFS_M2_FILESYSTEM"\
  "$LFS_FRAME_LOG"\
  "$LFS_BUILD_LOG"\
  $script

# set +x
