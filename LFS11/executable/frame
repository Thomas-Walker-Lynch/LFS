#!/bin/bash
# adds timing information and logging
#
script=$@

if [[ -z "$LFS_LOG_DIR" ]];then
  echo "$0 no \$LFS_LOG_DIR"
  exit 1
fi
if [[ -z "$FRAME_LOG" ]];then
  echo "$0 no \$FRAME_LOG"
  exit 2
fi
if [[ -z "$BUILD_LOG" ]];then
  echo "$0 no \$BUILD_LOG"
  exit 4
fi

frame_log_path="$LFS_LOG_DIR/$FRAME_LOG"
build_log_path="$LFS_LOG_DIR/$BUILD_LOG"
stamp=$(Z)
cat <<EOF | tee -a "$frame_log_path" >> "$build_log_path"

#--------------------------------------------------------------------------------
# $stamp
# start of: $script
#
#
EOF

#m2 does not have 'time'
# { /usr/bin/time -a -o "$frame_log_path" $script 2>&1 >&3 3>&- | tee -a "$frame_log_path" 3>&-; } >> "$build_log_path" 3>&1
#{ $script 2>&1 >&3 3>&- | tee -a "$frame_log_path" ; } >> "$build_log_path" 3>&1

{ { time $script ; } 2>&1 1>&3 | tee -a "$frame_log_path" ; } 1>> "$build_log_path" 3>&1

stamp=$(Z)
cat <<EOF | tee -a "$frame_log_path" >> "$build_log_path"

#
#
# end of: $script
# $stamp
#--------------------------------------------------------------------------------

EOF

